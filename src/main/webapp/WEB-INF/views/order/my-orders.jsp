<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã ÊàëÁöÑËÆ¢Âçï - HMS</title>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/static/css/common.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/static/css/background.css">
    <style>
        body {
            padding: 0;
        }
        
        /* ÂØºËà™Ê†è */
        .navbar {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: var(--spacing-md) 0;
        }
        
        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }
        
        .navbar-brand {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .navbar-nav {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }
        
        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-small);
            transition: all var(--transition-fast);
            font-size: var(--font-size-sm);
        }
        
        .nav-link:hover {
            color: var(--primary-color);
            background: rgba(107, 115, 255, 0.1);
        }
        
        /* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            max-width: 1200px;
            margin: var(--spacing-xl) auto;
            padding: 0 var(--spacing-md);
        }
        
        .page-header {
            background: var(--bg-primary);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-light);
            padding: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
            text-align: center;
        }
        
        .page-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .page-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
        }
        
        /* Á≠õÈÄâÂå∫Âüü */
        .filter-section {
            background: var(--bg-primary);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-light);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }
        
        .filter-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            align-items: end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }
        
        .filter-input {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: var(--font-size-sm);
            transition: all var(--transition-fast);
        }
        
        .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(107, 115, 255, 0.1);
        }
        
        .filter-btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: var(--font-size-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-normal);
        }
        
        .filter-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }
        
        /* ËÆ¢ÂçïÂàóË°® */
        .orders-container {
            background: var(--bg-primary);
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-light);
            padding: var(--spacing-xl);
        }
        
        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }
        
        .orders-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .orders-count {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }
        
        .order-card {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-large);
            padding: var(--spacing-xl);
            transition: all var(--transition-normal);
            cursor: pointer;
        }
        
        .order-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-medium);
            transform: translateY(-2px);
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-lg);
        }
        
        .order-info {
            flex: 1;
        }
        
        .order-number {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }
        
        .order-date {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .order-status {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius-small);
            font-size: var(--font-size-xs);
            font-weight: 500;
            text-align: center;
            min-width: 80px;
        }
        
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d1ecf1; color: #0c5460; }
        .status-checked-in { background: #d4edda; color: #155724; }
        .status-completed { background: #e2e3e5; color: #383d41; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        
        .order-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        
        .order-detail {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }
        
        .detail-value {
            font-size: var(--font-size-sm);
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
        }
        
        .order-price {
            font-size: var(--font-size-lg);
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .order-actions {
            display: flex;
            gap: var(--spacing-sm);
        }
        
        .action-btn {
            padding: var(--spacing-xs) var(--spacing-md);
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: var(--border-radius-small);
            font-size: var(--font-size-xs);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .action-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .action-btn.primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .action-btn.primary:hover {
            background: var(--primary-dark);
        }
        
        .action-btn.danger {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
        }
        
        .action-btn.danger:hover {
            background: #d32f2f;
        }
        
        /* Âä†ËΩΩÂíåÁ©∫Áä∂ÊÄÅ */
        .loading, .empty-state {
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-md);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }
        
        /* ÂìçÂ∫îÂºè */
        @media (max-width: 768px) {
            .filter-form {
                grid-template-columns: 1fr;
            }
            
            .order-content {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .order-header {
                flex-direction: column;
                gap: var(--spacing-md);
                align-items: stretch;
            }
            
            .order-footer {
                flex-direction: column;
                gap: var(--spacing-md);
                align-items: stretch;
            }
            
            .order-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="${pageContext.request.contextPath}/" class="navbar-brand">üè† HMS</a>
            <div class="navbar-nav">
                <a href="${pageContext.request.contextPath}/" class="nav-link">üè† È¶ñÈ°µ</a>
                <a href="${pageContext.request.contextPath}/room/list" class="nav-link">üè° ÊàøÊ∫ê</a>
                <c:choose>
                    <c:when test="${not empty sessionScope.currentUser}">
                        <!-- Â∑≤ÁôªÂΩïÁî®Êà∑ -->
                        <a href="${pageContext.request.contextPath}/order/my" class="nav-link">üìã ÊàëÁöÑËÆ¢Âçï</a>
                        <a href="${pageContext.request.contextPath}/user/profile" class="nav-link">üë§ ${sessionScope.currentUser.realName}</a>
                        <a href="#" class="nav-link" onclick="logout()">üö™ ÈÄÄÂá∫</a>
                    </c:when>
                    <c:otherwise>
                        <!-- Êú™ÁôªÂΩïÁî®Êà∑ -->
                        <a href="${pageContext.request.contextPath}/user/login" class="nav-link">üë§ ÁôªÂΩï</a>
                        <a href="${pageContext.request.contextPath}/user/register" class="nav-link">üìù Ê≥®ÂÜå</a>
                    </c:otherwise>
                </c:choose>
            </div>
        </div>
    </nav>
    
    <div class="main-content">
        <!-- È°µÈù¢Ê†áÈ¢ò -->
        <div class="page-header">
            <h1 class="page-title">üìã ÊàëÁöÑËÆ¢Âçï</h1>
            <p class="page-subtitle">ÁÆ°ÁêÜÊÇ®ÁöÑÊâÄÊúâÈ¢ÑËÆ¢ËÆ¢Âçï</p>
        </div>
        
        <!-- Á≠õÈÄâÂå∫Âüü -->
        <div class="filter-section">
            <form class="filter-form" id="filterForm">
                <div class="filter-group">
                    <label class="filter-label">ËÆ¢ÂçïÁä∂ÊÄÅ</label>
                    <select class="filter-input" id="orderStatus" name="orderStatus">
                        <option value="">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                        <option value="0">ÂæÖÁ°ÆËÆ§</option>
                        <option value="1">Â∑≤Á°ÆËÆ§</option>
                        <option value="2">Â∑≤ÂÖ•‰Ωè</option>
                        <option value="3">Â∑≤ÂÆåÊàê</option>
                        <option value="4">Â∑≤ÂèñÊ∂à</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">ÊîØ‰ªòÁä∂ÊÄÅ</label>
                    <select class="filter-input" id="paymentStatus" name="paymentStatus">
                        <option value="">ÂÖ®ÈÉ®Áä∂ÊÄÅ</option>
                        <option value="0">Êú™ÊîØ‰ªò</option>
                        <option value="1">Â∑≤ÊîØ‰ªò</option>
                        <option value="2">Â∑≤ÈÄÄÊ¨æ</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <button type="submit" class="filter-btn">
                        üîç Á≠õÈÄâËÆ¢Âçï
                    </button>
                </div>
            </form>
        </div>
        
        <!-- ËÆ¢ÂçïÂàóË°® -->
        <div class="orders-container">
            <div class="orders-header">
                <h2 class="orders-title">ËÆ¢ÂçïÂàóË°®</h2>
                <div class="orders-count" id="ordersCount">Ê≠£Âú®Âä†ËΩΩ...</div>
            </div>
            
            <div id="ordersContainer">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Ê≠£Âú®Âä†ËΩΩËÆ¢Âçï‰ø°ÊÅØ...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentOrders = [];

        // Êó•ÊúüÊ†ºÂºèÂåñÂáΩÊï∞
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadOrders();
            
            // Á≠õÈÄâË°®ÂçïÊèê‰∫§
            document.getElementById('filterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                loadOrders();
            });
        });
        
        // Âä†ËΩΩËÆ¢ÂçïÂàóË°®
        async function loadOrders() {
            const container = document.getElementById('ordersContainer');
            const countElement = document.getElementById('ordersCount');
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            container.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Ê≠£Âú®Âä†ËΩΩËÆ¢Âçï‰ø°ÊÅØ...</div>
                </div>
            `;
            
            // Êî∂ÈõÜÁ≠õÈÄâÂèÇÊï∞
            const formData = new FormData(document.getElementById('filterForm'));
            const params = new URLSearchParams();
            
            for (let [key, value] of formData.entries()) {
                if (value.trim()) {
                    params.append(key, value);
                }
            }
            
            try {
                const response = await fetch(`${pageContext.request.contextPath}/order/my/list?${params}`);
                const data = await response.json();
                
                if (data.code === 200) {
                    currentOrders = data.data;
                    displayOrders(currentOrders);
                    countElement.textContent = `ÂÖ± ${currentOrders.length} ‰∏™ËÆ¢Âçï`;
                } else if (data.code === 401) {
                    window.location.href = '${pageContext.request.contextPath}/user/login';
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üòî</div>
                            <div>Âä†ËΩΩÂ§±Ë¥•Ôºö${data.message}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Âä†ËΩΩËÆ¢ÂçïÂ§±Ë¥•:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üòî</div>
                        <div>ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï</div>
                    </div>
                `;
            }
        }
        
        // ÊòæÁ§∫ËÆ¢ÂçïÂàóË°®
        function displayOrders(orders) {
            const container = document.getElementById('ordersContainer');
            
            if (!orders || orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div>ÊöÇÊó†ËÆ¢Âçï</div>
                        <div style="margin-top: var(--spacing-md); font-size: var(--spacing-sm);">
                            <a href="${pageContext.request.contextPath}/room/list" style="color: var(--primary-color);">ÂéªÈ¢ÑËÆ¢ÊàøÊ∫ê</a>
                        </div>
                    </div>
                `;
                return;
            }
            
            const ordersList = document.createElement('div');
            ordersList.className = 'orders-list';
            
            orders.forEach(order => {
                const orderCard = createOrderCard(order);
                ordersList.appendChild(orderCard);
            });
            
            container.innerHTML = '';
            container.appendChild(ordersList);
        }
        
        // ÂàõÂª∫ËÆ¢ÂçïÂç°Áâá
        function createOrderCard(order) {
            const card = document.createElement('div');
            card.className = 'order-card';
            card.onclick = () => viewOrderDetail(order.id);
            
            const statusClass = getStatusClass(order.orderStatus);
            const statusText = getStatusText(order.orderStatus);
            const paymentStatusText = getPaymentStatusText(order.paymentStatus);
            
            card.innerHTML =
                '<div class="order-header">' +
                    '<div class="order-info">' +
                        '<div class="order-number">ËÆ¢ÂçïÂè∑Ôºö' + (order.orderNo || 'Êú™Áü•') + '</div>' +
                        '<div class="order-date">‰∏ãÂçïÊó∂Èó¥Ôºö' + formatDate(order.createTime) + '</div>' +
                    '</div>' +
                    '<div class="order-status ' + statusClass + '">' + statusText + '</div>' +
                '</div>'
 +
                '<div class="order-content">' +
                    '<div class="order-detail">' +
                        '<div class="detail-label">üè† ÊàøÊ∫ê‰ø°ÊÅØ</div>' +
                        '<div class="detail-value">' + (order.roomName || 'ÊàøÊ∫ê‰ø°ÊÅØ') + '</div>' +
                    '</div>' +
                    '<div class="order-detail">' +
                        '<div class="detail-label">üìÖ ÂÖ•‰ΩèÊó•Êúü</div>' +
                        '<div class="detail-value">' + formatDate(order.checkInDate) + ' - ' + formatDate(order.checkOutDate) + '</div>' +
                    '</div>' +
                    '<div class="order-detail">' +
                        '<div class="detail-label">üë• ÂÖ•‰Ωè‰∫∫Êï∞</div>' +
                        '<div class="detail-value">' + (order.guests || 0) + '‰∫∫ ¬∑ ' + (order.nights || 0) + 'Êôö</div>' +
                    '</div>' +
                '</div>' +
                '<div class="order-footer">' +
                    '<div class="order-price">' +
                        'ÊÄª‰ª∑Ôºö¬•' + (order.totalPrice || 0) +
                        '<span style="font-size: var(--font-size-sm); font-weight: 400; color: var(--text-secondary);">' +
                            '(' + paymentStatusText + ')' +
                        '</span>' +
                    '</div>' +
                    '<div class="order-actions">' +
                        generateOrderActions(order) +
                    '</div>' +
                '</div>';
            
            return card;
        }
        
        // ÁîüÊàêËÆ¢ÂçïÊìç‰ΩúÊåâÈíÆ
        function generateOrderActions(order) {
            let actions = [];
            
            // Êü•ÁúãËØ¶ÊÉÖÊåâÈíÆ
            actions.push('<button class="action-btn" onclick="event.stopPropagation(); viewOrderDetail(' + order.id + ')">Êü•ÁúãËØ¶ÊÉÖ</button>');

            // Ê†πÊçÆËÆ¢ÂçïÁä∂ÊÄÅÊòæÁ§∫‰∏çÂêåÊìç‰Ωú
            if (order.orderStatus === 0) { // ÂæÖÁ°ÆËÆ§
                if (order.paymentStatus === 0) { // Êú™ÊîØ‰ªò
                    actions.push('<button class="action-btn primary" onclick="event.stopPropagation(); payOrder(' + order.id + ')">Á´ãÂç≥ÊîØ‰ªò</button>');
                }
                actions.push('<button class="action-btn danger" onclick="event.stopPropagation(); cancelOrder(' + order.id + ')">ÂèñÊ∂àËÆ¢Âçï</button>');
            } else if (order.orderStatus === 1 && order.paymentStatus === 0) { // Â∑≤Á°ÆËÆ§‰ΩÜÊú™ÊîØ‰ªò
                actions.push('<button class="action-btn primary" onclick="event.stopPropagation(); payOrder(' + order.id + ')">Á´ãÂç≥ÊîØ‰ªò</button>');
            }
            
            return actions.join('');
        }
        
        // Ëé∑ÂèñÁä∂ÊÄÅÊ†∑ÂºèÁ±ª
        function getStatusClass(status) {
            const statusMap = {
                0: 'status-pending',
                1: 'status-confirmed',
                2: 'status-checked-in',
                3: 'status-completed',
                4: 'status-cancelled'
            };
            return statusMap[status] || 'status-pending';
        }
        
        // Ëé∑ÂèñÁä∂ÊÄÅÊñáÊú¨
        function getStatusText(status) {
            const statusMap = {
                0: 'ÂæÖÁ°ÆËÆ§',
                1: 'Â∑≤Á°ÆËÆ§',
                2: 'Â∑≤ÂÖ•‰Ωè',
                3: 'Â∑≤ÂÆåÊàê',
                4: 'Â∑≤ÂèñÊ∂à'
            };
            return statusMap[status] || 'Êú™Áü•Áä∂ÊÄÅ';
        }
        
        // Ëé∑ÂèñÊîØ‰ªòÁä∂ÊÄÅÊñáÊú¨
        function getPaymentStatusText(status) {
            const statusMap = {
                0: 'Êú™ÊîØ‰ªò',
                1: 'Â∑≤ÊîØ‰ªò',
                2: 'Â∑≤ÈÄÄÊ¨æ'
            };
            return statusMap[status] || 'Êú™Áü•';
        }
        
        // Ê†ºÂºèÂåñÊó•Êúü
        function formatDate(dateString) {
            if (!dateString) return 'Êú™Áü•';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }
        
        // Êü•ÁúãËÆ¢ÂçïËØ¶ÊÉÖ
        function viewOrderDetail(orderId) {
            window.location.href = '${pageContext.request.contextPath}/order/detail/' + orderId;
        }
        
        // ÊîØ‰ªòËÆ¢Âçï
        async function payOrder(orderId) {
            if (!confirm('Á°ÆËÆ§ÊîØ‰ªòÊ≠§ËÆ¢ÂçïÂêóÔºü')) return;
            
            try {
                const response = await fetch(`${pageContext.request.contextPath}/order/pay`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `orderId=${orderId}`
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    alert('ÊîØ‰ªòÊàêÂäüÔºÅ');
                    loadOrders(); // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÂçïÂàóË°®
                } else {
                    alert(data.message || 'ÊîØ‰ªòÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÊîØ‰ªòÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }
        
        // ÂèñÊ∂àËÆ¢Âçï
        async function cancelOrder(orderId) {
            const reason = prompt('ËØ∑ËæìÂÖ•ÂèñÊ∂àÂéüÂõ†ÔºàÂèØÈÄâÔºâÔºö');
            if (reason === null) return; // Áî®Êà∑ÂèñÊ∂à
            
            try {
                const response = await fetch(`${pageContext.request.contextPath}/order/cancel`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'orderId=' + orderId + '&cancelReason=' + encodeURIComponent(reason || '')
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    alert('ËÆ¢ÂçïÂèñÊ∂àÊàêÂäüÔºÅ');
                    loadOrders(); // ÈáçÊñ∞Âä†ËΩΩËÆ¢ÂçïÂàóË°®
                } else {
                    alert(data.message || 'ÂèñÊ∂àÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('ÂèñÊ∂àËÆ¢ÂçïÂ§±Ë¥•:', error);
                alert('ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï');
            }
        }
        
        // ÈÄÄÂá∫ÁôªÂΩï
        async function logout() {
            try {
                const response = await fetch('${pageContext.request.contextPath}/user/logout', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.code === 200) {
                    window.location.href = '${pageContext.request.contextPath}/';
                } else {
                    alert('ÈÄÄÂá∫Â§±Ë¥•');
                }
            } catch (error) {
                console.error('ÈÄÄÂá∫Â§±Ë¥•:', error);
                window.location.href = '${pageContext.request.contextPath}/';
            }
        }
    </script>
</body>
</html>
